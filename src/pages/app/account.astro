---
import AppLayout from "@/layouts/AppLayout.astro";
import { AccountView } from "@/components/account/AccountView";
import { requireAuth } from "@/lib/auth/guards";
import type { UserAccountDTO } from "@/types";

// Require authentication - must be checked before any rendering
const authResult = requireAuth(Astro);
if (authResult instanceof Response) {
  return authResult;
}

const authUser = authResult;

if (!authUser.email) {
  throw new Error("User email missing");
}

// Map Supabase User to UserAccountDTO
const user: UserAccountDTO = {
  id: authUser.id,
  email: authUser.email,
  created_at: authUser.created_at,
};
---

<AppLayout title="Moje konto - 10x Cards">
  <AccountView user={user} client:load />
</AppLayout>
