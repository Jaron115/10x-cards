---
import Layout from "./Layout.astro";
import { Sidebar } from "../components/navigation/Sidebar";

interface Props {
  title?: string;
}

const { title = "10x Cards" } = Astro.props;

// Authentication is checked in each page before using this layout
// So we can safely assume user exists in Astro.locals
const user = Astro.locals.user;

if (!user) {
  // This should never happen if pages properly use requireAuth
  // But we include it as a safety check
  return Astro.redirect("/");
}

const userEmail = user.email || undefined;
const currentPath = Astro.url.pathname;
---

<Layout title={title}>
  <div class="min-h-screen flex bg-gray-50">
    <!-- Sidebar - hidden on mobile, visible on lg+ -->
    <Sidebar currentPath={currentPath} userEmail={userEmail} client:load />

    <!-- Main content - full width on mobile, with sidebar space on lg+ -->
    <main class="flex-1 overflow-y-auto w-full">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">
        <slot />
      </div>
    </main>
  </div>
</Layout>
